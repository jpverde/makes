<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Makes</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Makes</li><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="architecture/index.html"><strong aria-hidden="true">2.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="contributing/index.html"><strong aria-hidden="true">3.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="governance/index.html"><strong aria-hidden="true">4.</strong> Governance</a></li><li class="chapter-item expanded affix "><li class="part-title">Security</li><li class="chapter-item expanded "><a href="security/index.html"><strong aria-hidden="true">5.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="security/design-principles/index.html"><strong aria-hidden="true">6.</strong> Design Principles</a></li><li class="chapter-item expanded "><a href="security/assurance/index.html"><strong aria-hidden="true">7.</strong> Software Assurance</a></li><li class="chapter-item expanded "><a href="security/slsa/index.html"><strong aria-hidden="true">8.</strong> SLSA</a></li><li class="chapter-item expanded "><a href="security/threat-model/index.html"><strong aria-hidden="true">9.</strong> Threat Model</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Makes</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/fluidattacks/makes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="break-before: page; page-break-before: always;"></div><h1 id="-makes"><a class="header" href="#-makes">ðŸ¦„ Makes</a></h1>
<p>A software supply chain framework powered by Nix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<pre class="mermaid">flowchart TB

  ci_cd_code[CI/CD as code]
  git_repo[Git Repository]
  inputs[Other inputs]
  project[Project]

  subgraph human[Interested Parties]
    consumer[Consumer]
    developer[Developer]
  end

  subgraph build[Hermetic and Reproducible Builds]
    nix[Nix Package Manager]
    nix_derivation[Nix Derivation SBOM]
    nix_store_path[Nix Store Path - Built artifact]
    nixpkgs_collection[Nixpkgs Collection]
    nixpkgs_module_system[Module System]
  end

  subgraph makes[Makes]
    makes_cli[Makes CLI]
    makes_framework[Makes Framework]
  end

  subgraph slsa[Supply Chain Security]
    slsa_provenance[SLSA Provenance Attestation]
  end

  consumer -- uses --&gt; makes_cli
  ci_cd_code -- uses --&gt; makes_framework
  ci_cd_code -- uses --&gt; nixpkgs_collection
  ci_cd_code -- uses --&gt; inputs
  developer -- uses --&gt; makes_cli
  developer -- maintains --&gt; project
  git_repo -- is fetched by --&gt; makes_cli
  git_repo -- contains --&gt; ci_cd_code
  makes_cli -- produces --&gt; slsa_provenance
  makes_cli -- uses --&gt; nix
  makes_framework -- uses --&gt; nixpkgs_module_system
  inputs -- is fetched by --&gt; nix
  nixpkgs_collection -- is fetched by --&gt; nix
  nixpkgs_module_system -- is fetched by --&gt; nix
  nix -- produces --&gt; nix_derivation
  nix -- produces --&gt; nix_store_path
  project -- has --&gt; git_repo
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing-to-makes"><a class="header" href="#contributing-to-makes">Contributing to Makes</a></h1>
<ul>
<li>Bug reports: <a href="https://github.com/fluidattacks/makes/issues">here</a></li>
<li>Feature requests: <a href="https://github.com/fluidattacks/makes/issues">here</a></li>
<li>Give us a star: <a href="https://github.com/fluidattacks/makes">here</a></li>
<li>Feedback: <a href="https://github.com/fluidattacks/makes/issues">here</a></li>
</ul>
<h2 id="code-contributions"><a class="header" href="#code-contributions">Code contributions</a></h2>
<p>We accept anything that benefits the community,
thanks for sharing your work with the world.
We can discuss implementation details <a href="https://github.com/fluidattacks/makes/issues">here</a>.</p>
<ol>
<li>Write your idea: <a href="https://github.com/fluidattacks/makes/issues">here</a></li>
<li>Fork <a href="https://github.com/fluidattacks/makes">Makes on GitHub</a></li>
<li><a href="https://git-scm.com/">Git</a>-clone your fork</li>
<li>Hack as much as you like!</li>
<li><a href="https://git-scm.com/">Git</a>-commit your changes.</li>
<li><a href="https://git-scm.com/">Git</a>-push changes to your fork</li>
<li>Create a <strong>Pull Request</strong> from your fork to <a href="https://github.com/fluidattacks/makes">Makes</a></li>
</ol>
<p>Guidelines:</p>
<ul>
<li>Keep it simple</li>
<li>Remember we write code for humans, not machines</li>
<li>Write an argument: <code>/src/args</code></li>
<li>Write a module (if applies): <code>/src/evaluator/modules</code></li>
<li>Write docs: <code>/README.md</code> or <code>/docs</code></li>
<li>Write a test: <code>/makes.nix</code> or <code>/makes/**/main.nix</code></li>
<li>Write a test <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">GitHub workflow</a>: <code>/.github/workflows/dev.yml</code></li>
</ul>
<p>Examples:</p>
<ul>
<li><a href="https://github.com/fluidattacks/makes/commit/01fcd5790dd54b117da63bcc2480437135da8bb3">feat(build): #262 lint git mailmap</a></li>
<li><a href="https://github.com/fluidattacks/makes/commit/081835b563c712b7650dbc5bf1e306d4aff159cf">feat(build): #232 lint terraform</a></li>
<li><a href="https://github.com/fluidattacks/makes/commit/571cf059b521cb97396210f9fe4659ee74f675b4">feat(build): #232 test terraform</a></li>
<li><a href="https://github.com/fluidattacks/makes/commit/f827da16b685b07d7f987c668c0fe089aefa7931">feat(build): #232 deploy terraform</a></li>
<li><a href="https://github.com/fluidattacks/makes/commit/1c9f06a809bd92d56939d5809ce46058856fdf0a">feat(build): #252 aws secrets from env</a></li>
<li><a href="https://github.com/fluidattacks/makes/commit/99e9f77482a6cbc9858a7a928a91a8a8aa9ff353">feat(build): #232 make parallel utils</a></li>
</ul>
<h3 id="the-legal-side-of-contributions"><a class="header" href="#the-legal-side-of-contributions">The legal side of contributions</a></h3>
<p>All of the code
that you submit to our code repository
will be licensed under the <a href="https://mit-license.org">MIT license</a>.</p>
<p>Please add a <code>Signed-off-by: Full Name &lt;email&gt;</code> to your commits as explained <a href="https://wiki.linuxfoundation.org/dco">here</a>
to signal that you agree
to the terms of the following
<a href="https://developercertificate.org/">Developer Certificate of Origin</a>.</p>
<p>Thank you!</p>
<h3 id="review-process"><a class="header" href="#review-process">Review process</a></h3>
<p>Once a pull request is opened in the repository,
a maintainer must follow the following steps
to review it:</p>
<ol>
<li>Check that the proposed change has an associated issue,
enough discussion has happened on it,
and there is consensus in the implementation details,
and if we agree that implement it is a good idea.</li>
<li>Check if the change modifies the <a href="contributing//architecture/">Architecture</a>
in any way, and that it has been updated.</li>
<li>Check if the implementation follows the
<a href="contributing//security/design-principles/">Secure Design Principles</a>,
and documents there
any new interactions,
or updates the documentation accordingly.</li>
<li>Check if the implementation introduces new threats,
or changes/removes an existing threat,
and if the <a href="contributing//security/threat-model/">Threat Model</a>
documentation has been updated to reflect it.</li>
<li>Check if the change adds or modifies
an existing security property of the system,
and if the <a href="contributing//security/assurance/">Software Assurance</a>
documentation has been updated to reflect it.</li>
<li>Check if the CI/CD succeeded.
No job should fail
unless something unrelated to the pull request happened.</li>
<li>The <em>Developer Certificate of Origin</em> was accepted,
normally through checking
that the job in the CI/CD that verifies it succeeded.</li>
<li>The steps mentioned in the sections above were followed,
particularly check if the code is readable,
maintainable,
proper tests were added or updated,
the corresponding docs were added or updated,
and the architecture and design seems to be of good quality.</li>
</ol>
<!--  -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="governance"><a class="header" href="#governance">Governance</a></h1>
<p>Decisions, approvals, code reviews, etc,
are made by the project maintainers:</p>
<ul>
<li>Kevin Amado - <a href="https://github.com/kamadorueda">@kamadorueda</a></li>
<li>Daniel Salazar - <a href="https://github.com/dsalaza4">@dsalaza4</a></li>
<li>Jhon Perez - <a href="https://github.com/jpverde">@jpverde</a></li>
</ul>
<p>Discussions usually happen within the issues section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security"><a class="header" href="#security">Security</a></h1>
<p>This section evaluates Makes using various standards
and tries to address the security of Makes as an ecosystem
using the three following categories:</p>
<ul>
<li>Security of using the Makes CLI.</li>
<li>Security of the software built using Makes.</li>
<li>Security of Makes as a software project.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h1>
<h2 id="principle-of-least-privilege"><a class="header" href="#principle-of-least-privilege">Principle of Least Privilege</a></h2>
<ul>
<li>
<p>The Makes CLI is a python application that runs in user-space.
The privileges required are:</p>
<ul>
<li>Write access to the <code>${HOME}</code>,
which is normally owned by the user,
so no extra privileges
other than what the user already has are required.</li>
<li>Creating temporary files/directories,
which respects the <code>${TMPDIR}</code> environment variable,
which is a functionality normally available to a user,
so no extra privileges are required.</li>
<li>A system with Nix installed.</li>
<li>(optional) privileges to create Kernel namespaces.</li>
</ul>
</li>
<li>
<p>The Makes framework is simply a library
that aids the developer in creating build scripts,
so no privileges are required,
the Makes framework is just source code
that the user can opt-in to use.</p>
</li>
<li>
<p>When containers are built,
they are build by assembling an OCI-compliant image
(TAR files per each layer plus a JSON manifest),
without resorting to privileged daemons like that of Docker.
They are generated as any other build (hermetic, pure, etc)
using information from the Nix Store.</p>
</li>
</ul>
<h2 id="principle-of-fail-safe-defaults"><a class="header" href="#principle-of-fail-safe-defaults">Principle of Fail-Safe Defaults</a></h2>
<ul>
<li>
<p>By default, builds are run in a sandbox
that uses kernel namespaces
to prevent the build from accessing the network
and the external file system.</p>
<p>The user is given the option to opt-out from this behavior,
but this is enabled by default.</p>
</li>
<li>
<p>Generated files are created inside user-owned folders by default,
which inherit the security
that the user has previously defined for the directory.</p>
<p>An user may opt-out from this behavior by setting environment variables,
but user-owned folders are selected by default.</p>
</li>
<li>
<p>In the most common configuration,
the contents of the <code>/nix/store</code>
are never published to the internet.</p>
<p>A user may want to share artifacts with other users
in order to improve performance
by writing artifacts to a binary cache,
so that other users can download the artifacts
if they have already been built by other user,
but this behavior
requires configuring a read+write binary cache
and setting the corresponding access secret.</p>
<p>A read-only binary cache (<a href="https://cache.nixos.org">https://cache.nixos.org</a>)
and no write binary cache
is the default configuration,</p>
</li>
</ul>
<h2 id="principle-of-economy-of-mechanism"><a class="header" href="#principle-of-economy-of-mechanism">Principle of Economy of Mechanism</a></h2>
<ul>
<li>The Makes CLI is essentially a wrapper over Nix,
so the surface is as small as possible (~1000 loc).</li>
<li>The Makes Framework defines a common set of utilities
a user can opt-in to use,
saving the user the work of writing that functionality themselves
which would require the same amount of code anyway.</li>
</ul>
<h2 id="principle-of-complete-mediation"><a class="header" href="#principle-of-complete-mediation">Principle of Complete Mediation</a></h2>
<h2 id="principle-of-open-design"><a class="header" href="#principle-of-open-design">Principle of Open Design</a></h2>
<ul>
<li>Makes is Free and Open Source Software,
anyone can read its internals:
https://github.com/fluidattacks/makes</li>
</ul>
<h2 id="principle-of-separation-of-privilege"><a class="header" href="#principle-of-separation-of-privilege">Principle of Separation of Privilege</a></h2>
<h2 id="principle-of-least-common-mechanism"><a class="header" href="#principle-of-least-common-mechanism">Principle of Least Common Mechanism</a></h2>
<ul>
<li>In the most common case
each user of Makes has a personal <code>/nix/store</code>
and a personal installation of Nix.
The <code>/nix/store</code> contents are not shared between users by default,
unless the user configures a read+write binary cache
and sets the corresponding binary cache secret.</li>
</ul>
<h2 id="principle-of-psychological-acceptability"><a class="header" href="#principle-of-psychological-acceptability">Principle of Psychological Acceptability</a></h2>
<ul>
<li>The Makes CLI is easy to use.
Performing an installation using the default values
yields a sufficiently secure version of the system.
Users familiar with other build tools would feel at home.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software-assurance"><a class="header" href="#software-assurance">Software Assurance</a></h1>
<p>This is what user can expect from Makes in terms of security,
the notation is that of a <em>Structured Assurance Case Model</em><sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<ul>
<li>
<p>The Makes CLI application is free of known security vulnerabilities.</p>
<ul>
<li>
<p>The Python code of the Makes CLI application
is free of known security vulnerabilities.</p>
<ul>
<li>
<p><a href="https://sonarcloud.io/">SonarCloud</a>
reviews every pull request.</p>
<p>Proof:</p>
<ul>
<li>
<p>You can check the
<a href="https://sonarcloud.io/project/pull_requests_list?id=fluidattacks_makes">SonarCloud pull requests list for Makes</a></p>
</li>
<li>
<p>You can check the
<a href="https://github.com/fluidattacks/makes/pulls">pull requests history</a>
and see if the latest pull requests
have a comment
from SonarCloud.
For example:
<a href="https://github.com/fluidattacks/makes/pull/925#issuecomment-1256837172">PR 925, Comment 1256837172</a></p>
</li>
</ul>
</li>
<li>
<p>Vulnerabilities count on <a href="https://sonarcloud.io/">SonarCloud</a> is zero.</p>
<p>Proof:</p>
<ul>
<li>Visit the <a href="https://sonarcloud.io/project/overview?id=fluidattacks_makes">SonarCloud dashboard</a>.
The vulnerabilities count should be zero.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The dependencies of the Makes CLI application
are free of known security vulnerabilities.</p>
<ul>
<li>
<p><a href="https://docs.github.com/en/code-security/dependabot/dependabot-alerts/about-dependabot-alerts">Dependabot alerts</a>
are enabled for the repository.</p>
<p>Proof:</p>
<ul>
<li>As a project maintainer,
you can see if Dependabot is enabled
<a href="https://github.com/fluidattacks/makes/security/dependabot">here</a>.</li>
<li>As an external user,
there is no way to verify
if Dependabot is enabled
because the configuration page for this
is only available to repository maintainers.
However,
it is possible to see the pull requests created by the bot,
for example:
<a href="https://github.com/fluidattacks/makes/pull/927">PR 927</a>.
Additionally,
an external user could check
if there has been Dependabot pull requests recently
by checking the
<a href="https://github.com/fluidattacks/makes/pulls">pull requests history</a>.
It is important to note
that if no recent pull requests exist
it may mean
that no known security vulnerabilities have been found,
and not necessarily that this claim is false.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!--  -->
<h2 id="references"><a class="header" href="#references">References</a></h2>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Rhodes, T. , Boland Jr., F. , Fong, E. and Kass, M. (2009),
Software Assurance Using Structured Assurance Case Models,
NIST Interagency/Internal Report (NISTIR),
National Institute of Standards and Technology,
Gaithersburg, MD, [online],
https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=902688
(Accessed September 23, 2022)</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="supply-chain-levels-for-software-artifacts"><a class="header" href="#supply-chain-levels-for-software-artifacts">Supply Chain Levels for Software Artifacts</a></h1>
<p>The <a href="https://slsa.dev/">SLSA framework</a>
helps organizations measure
the level of assurance
that the Software Artifacts they produce
actually contain and use what they intended (integrity),
by ensuring that the whole build and release process,
and all of the involved sources and dependencies
cannot be tampered with.</p>
<p>In this document,
we use the
<a href="https://slsa.dev/spec/v0.1/requirements">version 0.1 of the specification</a>.</p>
<p>Our current SLSA level is 2.
The following is a detail of the levels achieved
on each of the requirements:</p>
<table><thead><tr><th align="left">Requirement</th><th align="center">Level</th></tr></thead><tbody>
<tr><td align="left">Source - Version Controlled</td><td align="center">4</td></tr>
<tr><td align="left">Source - Verified History</td><td align="center">4</td></tr>
<tr><td align="left">Source - Retained Indefinitely</td><td align="center">4</td></tr>
<tr><td align="left">Source - Two Person Reviewed</td><td align="center">3</td></tr>
<tr><td align="left">Build - Scripted Build</td><td align="center">4</td></tr>
<tr><td align="left">Build - Build Service</td><td align="center">4</td></tr>
<tr><td align="left">Build - Build As Code</td><td align="center">4</td></tr>
<tr><td align="left">Build - Ephemeral Environment</td><td align="center">4</td></tr>
<tr><td align="left">Build - Isolated</td><td align="center">2</td></tr>
<tr><td align="left">Build - Parameter-less</td><td align="center">4</td></tr>
<tr><td align="left">Build - Hermetic</td><td align="center">4</td></tr>
<tr><td align="left">Build - Reproducible</td><td align="center">4</td></tr>
<tr><td align="left">Provenance - Available</td><td align="center">4</td></tr>
<tr><td align="left">Provenance - Authenticated</td><td align="center">4</td></tr>
<tr><td align="left">Provenance - Service Generated</td><td align="center">4</td></tr>
<tr><td align="left">Provenance - Non-Falsifiable</td><td align="center">4</td></tr>
<tr><td align="left">Provenance - Dependencies Complete</td><td align="center">4</td></tr>
<tr><td align="left">Common - Security</td><td align="center">4</td></tr>
<tr><td align="left">Common - Access</td><td align="center">4</td></tr>
<tr><td align="left">Common - Superusers</td><td align="center">3</td></tr>
</tbody></table>
<p>For clarity,
this is how SLSA definitions map into our infrastructure:</p>
<ul>
<li><strong>Source</strong>: Git repository at:
<a href="https://github.com/fluidattacks/makes">github.com/fluidattacks/makes</a>.</li>
<li><strong>Platform</strong>: <a href="https://docs.github.com/en/actions">GitHub Actions</a>,
<a href="https://github.com/fluidattacks/makes">Makes</a>,
and the <a href="https://nixos.org/">Nix package manager</a>.</li>
<li><strong>Build service</strong>:
<a href="https://docs.github.com/en/actions">GitHub Actions</a>,
using GitHub hosted runners.</li>
<li><strong>Build</strong>: A Nix derivation.</li>
<li><strong>Environment</strong>: A sandbox
that <a href="https://en.wikipedia.org/wiki/Chroot">Chroot</a>s
into an empty temporary directory,
provides private versions
of <code>/proc</code>, <code>/dev</code>, <code>/dev/shm</code>, and <code>/dev/pts</code>,
and uses a private PID, mount, network, IPC, and UTS namespace
to isolate itself from other processes in the system.</li>
<li><strong>Steps</strong>: Instructions declared
in the corresponding Makes configuration files
written using the Nix programming language
and shell scripting, versioned as-code in the <em>source</em>.</li>
</ul>
<h2 id="source-requirements"><a class="header" href="#source-requirements">Source Requirements</a></h2>
<h3 id="version-controlled"><a class="header" href="#version-controlled">Version controlled</a></h3>
<p>Every change to the source is tracked on GitHub,
using the Git version control system.</p>
<ul>
<li>
<p><strong>Change history</strong>: There exists a record
of the history of changes
that went into the revision.
Each change contains:
the identities of the uploader and reviewers (if any),
timestamps of the reviews (if any) and submission,
the change description/justification,
the content of the change,
and the parent revisions.</p>
<p>For example: <a href="https://github.com/fluidattacks/makes/pull/649">PR 649</a>.</p>
</li>
<li>
<p><strong>Immutable reference</strong>:
There exists a way to indefinitely reference a particular,
immutable revision.
For example:
<a href="https://github.com/fluidattacks/makes/commit/c61feb1be11abc4d7ffed52c660a45c57f06599c">c61feb1be11abc4d7ffed52c660a45c57f06599c</a>.</p>
</li>
</ul>
<h3 id="verified-history"><a class="header" href="#verified-history">Verified history</a></h3>
<p>Every change in the revisionâ€™s history
need to pass through a Pull Request.</p>
<p>In order to approve a Pull Request
the reviewer need to be strongly authenticated into GitHub.
The authentication process requires 2FA,
and the dates of the change
are recorded in the Pull Request.</p>
<p>Only users who were previously granted access
by a platform Admin can review Pull Requests.
External contributors can create a Pull Request
without any special privileges,
but it won't be merged
until reviewers submit their approval.</p>
<p>For example:
<a href="https://github.com/fluidattacks/makes/pull/649">PR 649</a>.</p>
<h3 id="retained-indefinitely"><a class="header" href="#retained-indefinitely">Retained indefinitely</a></h3>
<p>The revision and its change history
are preserved indefinitely
and cannot be deleted
or modified (not even with multi-party approval).
Additionally,
the main branch is protected
against accidental history overwrite
using GitHub's branch protection rules.</p>
<p>At the moment,
no legal requirement
impedes us to preserve indefinitely our change history,
and no obliteration policy is in effect.
In fact, our source code is Free and Open Source Software:
Anyone can download or fork the repository.</p>
<h3 id="two-person-reviewed"><a class="header" href="#two-person-reviewed">Two Person Reviewed</a></h3>
<p>Every change in the revisionâ€™s history
is agreed to by at least one trusted person
prior to submission
and each of these trusted persons
are authenticated into the platform (using 2FA) first.
Only project maintainers can merge Pull Requests
and therefore append a change into the revision's history.</p>
<h2 id="build-requirements"><a class="header" href="#build-requirements">Build Requirements</a></h2>
<h3 id="scripted-build"><a class="header" href="#scripted-build">Scripted Build</a></h3>
<p>All build steps were fully defined
using GitHub Actions, Makes and Nix.</p>
<p>Manual commands are not necessary to invoke the build script.
A new build is triggered automatically
each time new changes are pushed to the repository.</p>
<p>For example:</p>
<ul>
<li><a href="https://github.com/fluidattacks/makes/blob/27b4938a95990e3239626bf7f5c67e1f60ed8e21/.github/workflows/prod.yml">.github/workflows/prod.yml</a></li>
<li><a href="https://github.com/fluidattacks/makes/blob/27b4938a95990e3239626bf7f5c67e1f60ed8e21/makes/cli/pypi/main.nix">makes/cli/pypi/main.nix</a></li>
</ul>
<h3 id="build-service"><a class="header" href="#build-service">Build Service</a></h3>
<p>All build steps run on GitHub Actions
using GitHub hosted runners.</p>
<p>For example:</p>
<ul>
<li><a href="https://github.com/fluidattacks/makes/actions">Actions tab</a></li>
</ul>
<h3 id="build-as-code"><a class="header" href="#build-as-code">Build As Code</a></h3>
<p>All build steps have been stored and versioned
in the Git Repository.</p>
<p>For example:</p>
<ul>
<li><a href="https://github.com/fluidattacks/makes/blob/27b4938a95990e3239626bf7f5c67e1f60ed8e21/.github/workflows">.github/workflows</a></li>
</ul>
<h3 id="ephemeral-environment"><a class="header" href="#ephemeral-environment">Ephemeral Environment</a></h3>
<p>According to the <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners">GitHub Actions documentation</a>,</p>
<ul>
<li>&quot;Each GitHub-hosted runner
is a new virtual machine (VM)
hosted by GitHub with the runner application
and other tools preinstalled.&quot;</li>
<li>&quot;When the job begins,
GitHub automatically provisions a new VM for that job.
All steps in the job execute on the VM,
allowing the steps in that job to share information
using the runner's filesystem.
You can run workflows directly on the VM
or in a Docker container.
When the job has finished,
the VM is automatically decommissioned.&quot;</li>
</ul>
<p>Additionally,
the <a href="https://nixos.org/">Nix package manager</a>
provides an ephemeral environment to each of the derivations.
On Linux,
the environment is a sandbox
that <a href="https://en.wikipedia.org/wiki/Chroot">Chroot</a>s
into an empty temporary directory,
provides private versions
of <code>/proc</code>, <code>/dev</code>, <code>/dev/shm</code>, and <code>/dev/pts</code>,
and uses a private PID, mount, network, IPC, and UTS namespace
to isolate itself from other processes in the system.</p>
<h3 id="isolated"><a class="header" href="#isolated">Isolated</a></h3>
<p>Our build service
ensures that the build steps
run in an isolated environment
free of influence from other build instances,
whether prior or concurrent,
by using containerization technologies.</p>
<p>Builds are executed using the <a href="https://nixos.org/">Nix package manager</a>,
which prevents builds
from accessing any external environment variables,
network resources, sockets,
or paths in the file system.
and provides private versions
of <code>/proc</code>, <code>/dev</code>, <code>/dev/shm</code>, and <code>/dev/pts</code>,
and uses a private PID, mount, network, IPC, and UTS namespace
to isolate the build from other builds
happening concurrently in the system.</p>
<p>Input-addressed build caches are used to speed-up the pipeline.</p>
<h3 id="parameter-less"><a class="header" href="#parameter-less">Parameter-less</a></h3>
<p>The build output cannot be affected by user parameters
other than the build entry point
and the top-level source location.</p>
<p>In order to modify the build output,
a change to the source code must happen first.</p>
<h3 id="hermetic"><a class="header" href="#hermetic">Hermetic</a></h3>
<p>Builds are executed using the <a href="https://nixos.org/">Nix package manager</a>,
which prevents builds
from accessing any external environment variables,
network resources, sockets,
or paths in the file system.</p>
<p>All transitive build steps, sources, and dependencies
are fully declared up front with immutable references.</p>
<p>For example:</p>
<ul>
<li><a href="https://github.com/fluidattacks/makes/blob/27b4938a95990e3239626bf7f5c67e1f60ed8e21/makes/cli/pypi/pypi-sources.yaml">makes/cli/pypi/pypi-sources.yaml</a>.</li>
</ul>
<p>The <a href="https://nixos.org/">Nix package manager</a>:</p>
<ul>
<li>Fetches all of the declared artifacts
into a trusted control plane (the /nix/store).</li>
<li>Mounts into the build sandbox
the specific /nix/store paths required by it.</li>
<li>Allows a build to fetch artifacts over the network
if and only if the expected artifact integrity is specified.</li>
<li>Validates the integrity of each artifact
before allowing a build to use it,
and fails the build if the verification fails.</li>
<li>Denies network connectivity if no expected hash is specified.</li>
</ul>
<h3 id="reproducible"><a class="header" href="#reproducible">Reproducible</a></h3>
<p>All of our build scripts are intended to be reproducible.</p>
<p>The reproducibility guarantees of our build scripts
are that of the <a href="https://nixos.org/">Nix package manager</a>.</p>
<h2 id="provenance-requirements"><a class="header" href="#provenance-requirements">Provenance Requirements</a></h2>
<h3 id="available"><a class="header" href="#available">Available</a></h3>
<p>Provenance is produced by Makes,
and exposed by the build service
as a JSON document
together with the artifacts produced by the build.</p>
<p>Only builds that produce artifacts generate provenance,
because if a build does not produce artifacts,
then there wouldn't be something to verify the provenance of.</p>
<h3 id="authenticated"><a class="header" href="#authenticated">Authenticated</a></h3>
<p>The authenticity of the provenance
comes from the fact
that it can be downloaded
from the build service itself,
and therefore the authenticity claim
is as strong as the <em>Build and Source Requirements</em> are secure.</p>
<p>The integrity of the provenance
is displayed in the logs
and generated by Makes.</p>
<h3 id="service-generated"><a class="header" href="#service-generated">Service Generated</a></h3>
<p>The data in the provenance
is exposed by the build service,
and is generated by Makes.</p>
<p>Regular users of the service
are not able to inject
or alter the contents
because a build is fully determined
and automated by its configuration,
and the configuration comes directly from the source.</p>
<h3 id="non-falsifiable"><a class="header" href="#non-falsifiable">Non-Falsifiable</a></h3>
<p>The provenance
cannot be falsified by the build service's users:</p>
<ul>
<li>There is no secret material
to demonstrate the non-falsifiable nature of the provenance
(see <em>Provenance - Authenticated</em>).</li>
<li>Even if such secret material existed,
builds are run in an hermetic environment,
and therefore they wouldn't be available to the build steps
(see <em>Build - Hermetic</em>).</li>
<li>Every field in the provenance is generated
by the build service in a trusted control plane,
which is fully defined by the build configuration,
which comes directly from the Source,
and therefore is as secure as the Source is
(see <em>Source - Verified History</em>).</li>
</ul>
<h3 id="dependencies-complete"><a class="header" href="#dependencies-complete">Dependencies Complete</a></h3>
<p>The provenance contains all of dependencies
that were available while running the build steps.</p>
<p>This is guaranteed by the fact
that builds are hermetic
(see <em>Build - Hermetic</em>).
So for a build to succeed,
all of its dependencies must be declared,
and therefore the build tool (Makes and Nix)
who fetched them at build time,
have strong knowledge of their existence.</p>
<h2 id="common-requirements"><a class="header" href="#common-requirements">Common Requirements</a></h2>
<h3 id="security-1"><a class="header" href="#security-1">Security</a></h3>
<p>Please read the <a href="security/slsa//security/">Security page</a>.</p>
<h3 id="access"><a class="header" href="#access">Access</a></h3>
<p>Our build service (GitHub Actions) is SaaS,
and we use GitHub hosted runners.
Only some GitHub employees
may have access to the runners.
We cannot access the build service infrastructure
physically nor remotely.</p>
<h3 id="superusers"><a class="header" href="#superusers">Superusers</a></h3>
<p>Only a small number of platform admins may override the guarantees provided by SLSA.
Particularly through disabling security options
in the repository configuration page.
Doing so does not currently require approval
of a second platform admin.</p>
<!-- References -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h1>
<h2 id="spoofing"><a class="header" href="#spoofing">Spoofing</a></h2>
<ul>
<li>
<p>A user can mistype the Makes installation command
and wrongly install a different (potentially malicious) tool.</p>
<p>Mitigation:</p>
<ul>
<li>The installation command is given in plain-text,
users can copy-paste it to avoid typos.</li>
</ul>
</li>
<li>
<p>A user can mistype the target project to be built with Makes,
and end-up building (and potentially running)
a different (potentially malicious) project.</p>
<p>Mitigation:</p>
<ul>
<li>
<p>The most common use case
(running makes on the project in the current working directory)
has a very convenient syntax: <code>$ m .</code>,
which is very unlikely to be mistyped.</p>
</li>
<li>
<p>When referencing a project over the internet,
the user is forced to use a git provider (github/gitlab),
the owner account (which should be trusted by the user),
the target repository,
and a branch, commit or tag.</p>
<p>By using a commit,
the user can force the integrity of the downloaded data
to match what they expect.</p>
</li>
</ul>
</li>
</ul>
<h2 id="tampering"><a class="header" href="#tampering">Tampering</a></h2>
<ul>
<li>
<p>The Nix Store can be tampered with
if no good installation measures are taken by the user.</p>
<p>Mitigation:</p>
<ul>
<li>The Nix installation is responsibility of the user,
but in general,
a user could bind mount <code>/nix</code> as a read-only file system,
and make the <code>/nix/store</code> only accessible by root
and the <code>nixbld</code> group users,
reducing an attack vector to the physical or local layer,
which can be further protected
by the use of frameworks like <a href="https://slsa.dev/">SLSA</a>,
and full disk encryption using <a href="https://en.wikipedia.org/wiki/LUKS">LUKS</a>.</li>
</ul>
</li>
</ul>
<h2 id="repudiation"><a class="header" href="#repudiation">Repudiation</a></h2>
<ul>
<li>
<p>In single tenant setups,
for instance when developers run Makes in their laptops,
there is nothing to repudiate,
there is only one user performing builds (the developer).
However,
in multi-tenant setups,
for instance when Makes is run in a shared CI/CD system,
a user could deny running a build.</p>
<p>Mitigation:</p>
<ul>
<li>Makes produces
<a href="https://slsa.dev/provenance/v0.2">SLSA Provenance Attestations</a>,
which identify the builder and the built artifact.</li>
<li>Most CI/CD systems
(and particularly the ones supported by Makes)
offer logs collection,
so it would be easy to associate a build
with the identity that triggered it.
It is responsibility of the users
to configure such CI/CD systems
in a secure way and to protect (and backup) the logs.</li>
</ul>
</li>
</ul>
<h2 id="information-disclosure"><a class="header" href="#information-disclosure">Information Disclosure</a></h2>
<ul>
<li>
<p>Although the <code>/nix/store</code> is individual per user,
a user may write secrets to it,
and then those secrets can be published to a binary cache
that is publicly accessible.</p>
<p>Examples of this include Nix idioms like:</p>
<pre><code class="language-nix">[
  // Nix would load the secrets in plain-text to the `/nix/store`
  ./file-with-secrets-in-plain-text.txt

  // Nix would load the git repository to the `/nix/store`
  // This also applies to other builtins.fetch* that could
  // fetch private information
  (builtins.fetchGit {
    // Private repository (with potential intellectual property)
    url = &quot;git@github.com:company/secrets.git&quot;;
  })
]
</code></pre>
<p>Mitigation:</p>
<ul>
<li>
<p>Nothing from the <code>/nix/store</code>
is pushed to a binary cache by default.
A user would need to configure the cache explicitly,
and expose the corresponding secret
in an environment variable.</p>
</li>
<li>
<p>Makes has support for binary caches
that require a secret for reading and writting,
so a user may chose to use this instead
as an extra layer of prevention
if loading secrets to the <code>/nix/store</code> is mandatory.
Please see <a href="https://cachix.org/">https://cachix.org/</a> for more information.</p>
</li>
<li>
<p>Makes has utilities for working with secrets in a way
that they are only copied to the <code>/nix/store</code>
in encrypted form,
and then decrypted at runtime,
where there are safe from disclosure.</p>
<p>For example:
<code>secretsForAwsFromEnv</code>,
<code>secretsForAwsFromGitlab</code>,
<code>secretsForEnvFromSops</code>,
<code>secretsForGpgFromEnv</code>,
<code>secretsForKubernetesConfigFromAws</code>, and
<code>secretsForTerraformFromEnv</code>.</p>
<p>However, we don't currently have a way to protect the user
from using <code>builtins.fetch*</code>.
If your workflow needs this,
please avoid pushing artifacts to a public binary cache,
or use a private binary cache instead.</p>
</li>
<li>
<p>Makes copies the contents of the git repository
into a trusted control plane,
and excludes all of the files
that are not tracked by Git
from this checkout.
This means that if the file with secrets is inside the repository,
but included in the <code>.gitignore</code>
such that a <code>git fetch</code> of the given remote and revision
would ignore it,
Makes would not copy it into the trusted control plane,
and therefore Nix wouldn't load it into the <code>/nix/store</code>.</p>
</li>
</ul>
</li>
</ul>
<h2 id="denial-of-service"><a class="header" href="#denial-of-service">Denial of Service</a></h2>
<h2 id="elevation-of-privileges"><a class="header" href="#elevation-of-privileges">Elevation of Privileges</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
                <script type="text/javascript" src="mermaid.min.js"></script>
                <script type="text/javascript" src="mermaid-init.js"></script>
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
